<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>å¯Œå±±è¦³å…‰AIã‚¬ã‚¤ãƒ‰</title>
	<style>
		:root {
			color-scheme: light dark;
			--bg-gradient: radial-gradient(circle at top, #9fd6ff 0%, #f2f9ff 35%, #ffffff 60%, #e3f1ff 100%);
			--primary: #0069b4;
			--primary-dark: #004a80;
			--accent: #00a0c6;
			--text-main: #1c1c1c;
			--text-muted: #546478;
			--card-bg: rgba(255, 255, 255, 0.92);
			--shadow: 0 20px 35px rgba(0, 62, 114, 0.15);
		}
		* {
			box-sizing: border-box;
		}
		body {
			margin: 0;
			font-family: "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
			color: var(--text-main);
			background: var(--bg-gradient);
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}
		header {
			padding: 3.5rem 1.5rem 2.5rem;
			text-align: center;
			background: linear-gradient(160deg, rgba(0, 105, 180, 0.85), rgba(0, 160, 198, 0.75)), url('https://images.unsplash.com/photo-1586528116311-ad8dd3cc7ddd?auto=format&fit=crop&w=1400&q=80') center/cover no-repeat;
			color: #fff;
			box-shadow: 0 10px 30px rgba(0,0,0,0.25);
		}
		header h1 {
			margin: 0;
			font-size: clamp(2.4rem, 5vw, 3.4rem);
			letter-spacing: 0.08em;
		}
		header p {
			margin: 1rem auto 0;
			max-width: 600px;
			font-size: clamp(1.1rem, 2.4vw, 1.3rem);
			line-height: 1.7;
		}
		main {
			flex: 1;
			padding: 2rem 1.5rem 3rem;
			display: grid;
			gap: 2rem;
			max-width: 1100px;
			width: 100%;
			margin: -80px auto 0;
		}
		.panel {
			background: var(--card-bg);
			border-radius: 20px;
			padding: clamp(1.2rem, 2.8vw, 1.8rem);
			box-shadow: var(--shadow);
			backdrop-filter: blur(8px);
		}
		.panel h2 {
			margin-top: 0;
			font-size: 1.6rem;
			color: var(--primary);
		}
		.highlights {
			display: grid;
			gap: 1rem;
			grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
		}
		.highlight-card {
			padding: 1.1rem;
			border-radius: 16px;
			background: rgba(0, 105, 180, 0.08);
			border: 1px solid rgba(0, 105, 180, 0.12);
		}
		.highlight-card h3 {
			margin: 0 0 0.5rem;
		}
		.highlight-card ul {
			margin: 0;
			padding-left: 1.2rem;
			color: var(--text-muted);
		}
		.highlight-card a {
			color: var(--primary-dark);
			text-decoration: none;
			font-weight: bold;
		}
		.bot-wrapper {
			display: grid;
			gap: 1.5rem;
		}
		.chat-window {
			display: flex;
			flex-direction: column;
			gap: 1rem;
		}
		.chat-log {
			max-height: 360px;
			overflow-y: auto;
			padding: 1.2rem;
			border-radius: 16px;
			background: rgba(255,255,255,0.72);
			border: 1px solid rgba(0,105,180,0.08);
		}
		.message {
			margin-bottom: 1rem;
			display: flex;
			align-items: flex-start;
			gap: 0.75rem;
		}
		.message:last-child {
			margin-bottom: 0;
		}
		.avatar {
			width: 38px;
			height: 38px;
			border-radius: 12px;
			background: linear-gradient(135deg, var(--primary), var(--accent));
			display: flex;
			align-items: center;
			justify-content: center;
			color: #fff;
			font-weight: 700;
		}
		.message.user .avatar {
			background: #fff;
			color: var(--primary);
			border: 2px solid rgba(0,105,180,0.2);
		}
		.message-content {
			padding: 0.75rem 1rem;
			border-radius: 14px;
			max-width: min(100%, 520px);
			line-height: 1.6;
			background: rgba(0,105,180,0.08);
		}
		.message.user .message-content {
			background: rgba(0,160,198,0.12);
		}
		.chat-input {
			display: flex;
			gap: 0.8rem;
			border: 1px solid rgba(0,105,180,0.12);
			border-radius: 20px;
			padding: 0.4rem;
			background: rgba(255,255,255,0.9);
		}
		.chat-input textarea {
			flex: 1;
			border: none;
			resize: none;
			padding: 0.8rem 1rem;
			font-size: 1rem;
			font-family: inherit;
			background: transparent;
			color: inherit;
			min-height: 70px;
		}
		.chat-input textarea:focus {
			outline: none;
		}
		.chat-input button {
			padding: 0 1.5rem;
			border: none;
			border-radius: 16px;
			background: linear-gradient(135deg, var(--primary), var(--accent));
			color: #fff;
			font-weight: 600;
			cursor: pointer;
			transition: transform 0.2s ease, box-shadow 0.2s ease;
		}
		.chat-input button:hover {
			transform: translateY(-1px);
			box-shadow: 0 10px 20px rgba(0,105,180,0.25);
		}
		.preset-questions {
			display: flex;
			flex-wrap: wrap;
			gap: 0.6rem;
		}
		.preset-questions button {
			border: none;
			padding: 0.55rem 1rem;
			border-radius: 999px;
			background: rgba(0,105,180,0.12);
			color: var(--primary);
			cursor: pointer;
			transition: background 0.2s ease;
		}
		.preset-questions button:hover {
			background: rgba(0,105,180,0.22);
		}
		footer {
			text-align: center;
			padding: 1.4rem;
			color: var(--text-muted);
			font-size: 0.95rem;
		}
		footer a {
			color: var(--primary);
			text-decoration: none;
		}
		@media (max-width: 820px) {
			main {
				margin-top: -60px;
				padding: 1.5rem 1rem 2.4rem;
			}
		}
		@media (max-width: 640px) {
			header {
				padding: 3rem 1rem 2rem;
			}
			.chat-input {
				flex-direction: column;
				padding: 0.7rem;
			}
			.chat-input button {
				width: 100%;
				padding: 0.8rem;
			}
		}
	</style>
</head>
<body>
	<header>
		<h1>å¯Œå±±è¦³å…‰AIã‚¬ã‚¤ãƒ‰</h1>
		<p>å¯Œå±±è¦³å…‰å”ä¼šã®å…¬å¼æƒ…å ±ã‚’ã‚‚ã¨ã«ã—ãŸãƒãƒ¼ãƒãƒ£ãƒ«ã‚³ãƒ³ã‚·ã‚§ãƒ«ã‚¸ãƒ¥ãŒã€å­£ç¯€ã”ã¨ã®æ¥½ã—ã¿æ–¹ã‚„ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã‚’ã”æ¡ˆå†…ã—ã¾ã™ã€‚</p>
	</header>
	<main>
		<section class="panel">
			<h2>å¯Œå±±ã®è¦‹ã©ã“ã‚ãƒã‚¤ãƒ©ã‚¤ãƒˆ</h2>
			<div class="highlights" id="highlightCards"></div>
		</section>
		<section class="panel bot-wrapper">
			<h2>è¦³å…‰AIãƒœãƒƒãƒˆã«è³ªå•ã™ã‚‹</h2>
			<div class="preset-questions" id="presetQuestions"></div>
			<div class="chat-window">
				<div class="chat-log" id="chatLog" aria-live="polite"></div>
				<form class="chat-input" id="chatForm">
					<textarea id="userInput" placeholder="ä¾‹ï¼‰æ˜¥ã«ãŠã™ã™ã‚ã®è¦³å…‰åœ°ã¯ï¼Ÿ" required></textarea>
					<button type="submit">è³ªå•ã™ã‚‹</button>
				</form>
			</div>
		</section>
	</main>
	<footer>
		æƒ…å ±å…ƒï¼š<a href="https://www.info-toyama.com/" target="_blank" rel="noopener">å¯Œå±±çœŒè¦³å…‰å…¬å¼ã‚µã‚¤ãƒˆ ã¨ã‚„ã¾è¦³å…‰ãƒŠãƒ“</a>
	</footer>

	<script>
		const knowledgeBase = [
			{
				id: 'alps-route',
				name: 'ç«‹å±±é»’éƒ¨ã‚¢ãƒ«ãƒšãƒ³ãƒ«ãƒ¼ãƒˆ',
				category: 'è‡ªç„¶ãƒ»çµ¶æ™¯',
				seasons: ['æ˜¥', 'å¤', 'ç§‹'],
				keywords: ['ç«‹å±±', 'é›ªã®å¤§è°·', 'å®¤å ‚', 'é»’éƒ¨ãƒ€ãƒ ', 'é›²ä¸Šæ•£ç­–', 'ãƒã‚¤ã‚­ãƒ³ã‚°'],
				summary: 'æ¨™é«˜3,000mç´šã®ç«‹å±±é€£å³°ã‚’è²«ãå±±å²³è¦³å…‰ãƒ«ãƒ¼ãƒˆã€‚å®¤å ‚å¹³ã‚„é›ªã®å¤§è°·ã‚¦ã‚©ãƒ¼ã‚¯ã€é»’éƒ¨ãƒ€ãƒ æ”¾æ°´ãªã©å››å­£æŠ˜ã€…ã®çµ¶æ™¯ãŒæ¥½ã—ã‚ã‚‹ã€‚',
				tips: ['4æœˆã€œ6æœˆã¯é›ªã®å¤§è°·ãŒè¿«åŠ›æº€ç‚¹', 'å¤ã¯é«˜å±±æ¤ç‰©ã¨é›²æµ·ãƒã‚¤ã‚­ãƒ³ã‚°ãŒäººæ°—', 'ç§‹ã¯ç´…è‘‰ã¨ãƒ€ãƒ ã®æ”¾æ°´ãŒè¦‹ã©ã“ã‚'],
				link: 'https://www.info-toyama.com/spot/10003/',
			},
			{
				id: 'kurobe-gorge',
				name: 'é»’éƒ¨å³¡è°·ãƒˆãƒ­ãƒƒã‚³é›»è»Š',
				category: 'è‡ªç„¶ãƒ»ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£',
				seasons: ['æ˜¥', 'å¤', 'ç§‹'],
				keywords: ['é»’éƒ¨å³¡è°·', 'ãƒˆãƒ­ãƒƒã‚³', 'å®‡å¥ˆæœˆæ¸©æ³‰', 'ç´…è‘‰', 'æ¸“è°·ç¾'],
				summary: 'å®‡å¥ˆæœˆã€œæ¬…å¹³ã‚’çµã¶å±±å²³é‰„é“ã€‚æ¸“è°·ç¾ã‚„ã‚¨ãƒ¡ãƒ©ãƒ«ãƒ‰ã‚°ãƒªãƒ¼ãƒ³ã®é»’éƒ¨å·ã‚’çœºã‚ãªãŒã‚‰ãƒˆãƒ­ãƒƒã‚³é›»è»Šã§å†’é™ºæ°—åˆ†ã‚’å‘³ã‚ãˆã‚‹ã€‚',
				tips: ['10æœˆã€œ11æœˆã®ç´…è‘‰ãŒç‰¹ã«äººæ°—', 'å®‡å¥ˆæœˆæ¸©æ³‰ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨å……å®Ÿã—ãŸæ—…ã«', 'å¤ã¯æ¸“è°·ã®æ¶¼ã—ã•ã‚’æ±‚ã‚ã‚‹å®¶æ—é€£ã‚Œã«ã‚‚ãŠã™ã™ã‚'],
				link: 'https://www.info-toyama.com/spot/10017/',
			},
			{
				id: 'gokayama',
				name: 'ä¸–ç•Œéºç”£ äº”ç®‡å±±åˆæŒé€ ã‚Šé›†è½',
				category: 'æ–‡åŒ–ãƒ»æ­´å²',
				seasons: ['é€šå¹´'],
				keywords: ['äº”ç®‡å±±', 'ä¸–ç•Œéºç”£', 'åˆæŒé€ ã‚Š', 'ç›¸å€‰', 'è…æ²¼'],
				summary: 'ãƒ¦ãƒã‚¹ã‚³ä¸–ç•Œéºç”£ã«ç™»éŒ²ã•ã‚ŒãŸåˆæŒé€ ã‚Šé›†è½ã€‚èŒ…è‘ºãå±‹æ ¹ã®é›†è½ã§å±±é‡Œã®æš®ã‚‰ã—ã¨æ°‘è¬¡ã“ãã‚Šã“ç¯€ã®æ–‡åŒ–ã«è§¦ã‚Œã‚‰ã‚Œã‚‹ã€‚',
				tips: ['ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã®æ—¥ç¨‹ã‚’è¦ãƒã‚§ãƒƒã‚¯', 'å†¬ã¯é›ªæ™¯è‰²ã¨å›²ç‚‰è£ä½“é¨“ãŒé­…åŠ›', 'ä¼çµ±å·¥èŠ¸ã‚„éƒ·åœŸæ–™ç†ã®ä½“é¨“æ–½è¨­ã‚‚ã‚ã‚‹'],
				link: 'https://www.info-toyama.com/spot/10001/',
			},
			{
				id: 'toyama-city',
				name: 'å¯Œå±±å¸‚å†…è¦³å…‰ï¼ˆå¯Œå²©é‹æ²³ç’°æ°´å…¬åœ’ãƒ»ã‚¬ãƒ©ã‚¹ç¾è¡“é¤¨ãªã©ï¼‰',
				category: 'å¸‚è¡—åœ°æ•£ç­–',
				seasons: ['é€šå¹´'],
				keywords: ['å¯Œå±±å¸‚', 'ç’°æ°´å…¬åœ’', 'ã‚¬ãƒ©ã‚¹ç¾è¡“é¤¨', 'ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹', 'ãƒ©ã‚¤ãƒˆãƒ¬ãƒ¼ãƒ«'],
				summary: 'å¯Œå²©é‹æ²³ç’°æ°´å…¬åœ’ã®æ°´è¾ºæ™¯è¦³ã¨ä¸–ç•Œã®ç¾ã—ã„ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ã€éšˆç ”å¾æ°è¨­è¨ˆã®ã‚¬ãƒ©ã‚¹ç¾è¡“é¤¨ãªã©ã€ã‚¢ãƒ¼ãƒˆã¨è‡ªç„¶ãŒèåˆã—ãŸå¸‚å†…æ•£ç­–ãŒæ¥½ã—ã‚ã‚‹ã€‚',
				tips: ['å¤œã¯ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ãŒå¹»æƒ³çš„', 'å¸‚å†…é›»è»Šã€Œã‚»ãƒ³ãƒˆãƒ©ãƒ ã€ã§ã®ç§»å‹•ãŒä¾¿åˆ©', 'å¯Œå±±æ¹¾é®¨ãªã©ã‚°ãƒ«ãƒ¡ã¨ã®çµ„ã¿åˆã‚ã›ãŒãŠã™ã™ã‚'],
				link: 'https://www.info-toyama.com/spot/21028/',
			},
			{
				id: 'himi',
				name: 'æ°·è¦‹ã®æµ·ã¨ã‚°ãƒ«ãƒ¡',
				category: 'ã‚°ãƒ«ãƒ¡ãƒ»çµ¶æ™¯',
				seasons: ['å†¬', 'æ˜¥'],
				keywords: ['æ°·è¦‹', 'å¯’ãƒ–ãƒª', 'æµ·é®®', 'æœå¸‚', 'é›¨æ™´æµ·å²¸'],
				summary: 'æ°·è¦‹æ¸¯ã§ã¯å†¬ã®å¯’ãƒ–ãƒªã‚’ã¯ã˜ã‚å¯Œå±±æ¹¾ã®æ–°é®®ãªé­šä»‹ãŒå‘³ã‚ãˆã‚‹ã€‚é›¨æ™´æµ·å²¸ã‹ã‚‰ã®ç«‹å±±é€£å³°ã®çœºã‚ã‚‚äººæ°—ã€‚',
				tips: ['å¯’ãƒ–ãƒªã‚·ãƒ¼ã‚ºãƒ³ã¯11æœˆã€œ2æœˆé ƒ', 'é›¨æ™´æµ·å²¸ã®æ°—åµãŒè¦‹ã‚‰ã‚Œã‚‹æœã‚‚å¹»æƒ³çš„', 'æ°·è¦‹æ¼æ¸¯å ´å¤–å¸‚å ´ã²ã¿ç•ªå±‹è¡—ã§é£Ÿã¹æ­©ãã‚’æ¥½ã—ã‚ã‚‹'],
				link: 'https://www.info-toyama.com/spot/10008/',
			},
			{
				id: 'tateyama-onsen',
				name: 'ç«‹å±±å±±éº“æ¸©æ³‰ï¼ˆã‚‰ã„ã¡ã‚‡ã†ãƒãƒ¬ãƒ¼ãƒ»æ¥µæ¥½å‚ï¼‰',
				category: 'æ¸©æ³‰ãƒ»ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢',
				seasons: ['å†¬'],
				keywords: ['ã‚¹ã‚­ãƒ¼', 'ã‚‰ã„ã¡ã‚‡ã†ãƒãƒ¬ãƒ¼', 'æ¥µæ¥½å‚', 'æ¸©æ³‰', 'ç«‹å±±å±±éº“'],
				summary: 'ç«‹å±±å±±éº“ã®ã‚¹ã‚­ãƒ¼å ´ã¨æ¸©æ³‰ã‚¨ãƒªã‚¢ã€‚è‰¯è³ªãªãƒ‘ã‚¦ãƒ€ãƒ¼ã‚¹ãƒãƒ¼ã§ã‚¦ã‚£ãƒ³ã‚¿ãƒ¼ã‚¹ãƒãƒ¼ãƒ„ã‚’æº€å–«ã—ã€æ¸©æ³‰ã§ã˜ã£ãã‚Šæ¸©ã¾ã‚Œã‚‹ã€‚',
				tips: ['ãƒŠã‚¤ã‚¿ãƒ¼ã‚¹ã‚­ãƒ¼ã‚„ã‚¹ãƒãƒ¼ã‚·ãƒ¥ãƒ¼ä½“é¨“ã‚‚å¯èƒ½', 'ã‚¢ãƒ«ãƒšãƒ³ãƒ«ãƒ¼ãƒˆã¨çµ„ã¿åˆã‚ã›ãŸå†¬æ—…ã«ãŠã™ã™ã‚', 'è¦ªå­å‘ã‘é›ªéŠã³åºƒå ´ã‚‚å……å®Ÿ'],
				link: 'https://www.info-toyama.com/spot/10011/',
			},
			{
				id: 'imizu',
				name: 'æ–°æ¹Šãƒ»å°„æ°´ãƒ™ã‚¤ã‚¨ãƒªã‚¢ï¼ˆæµ·ç‹ä¸¸ãƒ‘ãƒ¼ã‚¯ï¼‰',
				category: 'æ¸¯ç”º',
				seasons: ['æ˜¥', 'å¤', 'ç§‹'],
				keywords: ['æµ·ç‹ä¸¸', 'ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—', 'æ–°æ¹Šå¤§æ©‹', 'å¸†èˆ¹', 'ãƒ™ã‚¤ã‚¨ãƒªã‚¢'],
				summary: 'ç¾å½¹ã‚’é€€ã„ãŸå¸†èˆ¹ã€Œæµ·ç‹ä¸¸ã€ãŒä¿‚ç•™ã•ã‚Œã‚‹æµ·ç‹ä¸¸ãƒ‘ãƒ¼ã‚¯ã§ã¯ã€å¸†ã‚’åºƒã’ã‚‹ç·å¸†å±•å¸†ã‚¤ãƒ™ãƒ³ãƒˆã‚„æ–°æ¹Šå¤§æ©‹ã®çœºæœ›ãŒæ¥½ã—ã‚ã‚‹ã€‚',
				tips: ['ç·å¸†å±•å¸†ã¯å¹´é–“ç´„10å›ã€æ—¥ç¨‹ãƒã‚§ãƒƒã‚¯æ¨å¥¨', 'å¤œé–“ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—ãŒãƒ­ãƒãƒ³ãƒãƒƒã‚¯', 'è¿‘éš£ã§ç™½ãˆã³æ¼æ¸¯ã®ã‚°ãƒ«ãƒ¡ã‚‚äººæ°—'],
				link: 'https://www.info-toyama.com/spot/21009/',
			},
		];

		const presetQuestions = [
			'æ˜¥ã«ãŠã™ã™ã‚ã®ã‚¹ãƒãƒƒãƒˆã¯ï¼Ÿ',
			'å®¶æ—é€£ã‚Œã§æ¥½ã—ã‚ã‚‹å ´æ‰€ã¯ï¼Ÿ',
			'å†¬ã®å‘³è¦šã‚’æ•™ãˆã¦',
			'é»’éƒ¨å³¡è°·ã®æ¥½ã—ã¿æ–¹ã‚’çŸ¥ã‚ŠãŸã„',
			'å¯Œå±±å¸‚å†…ã§ã‚¢ãƒ¼ãƒˆã«è§¦ã‚ŒãŸã„',
			'ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã‚’ææ¡ˆã—ã¦'
		];

		const highlightData = knowledgeBase.slice(0, 3);

		const chatLog = document.getElementById('chatLog');
		const chatForm = document.getElementById('chatForm');
		const userInput = document.getElementById('userInput');
		const presetContainer = document.getElementById('presetQuestions');
		const highlightContainer = document.getElementById('highlightCards');

		function createHighlightCards() {
			highlightData.forEach(item => {
				const card = document.createElement('article');
				card.className = 'highlight-card';
				card.innerHTML = `
					<h3>${item.name}</h3>
					<p>${item.summary}</p>
					<ul>
						${item.tips.map(tip => `<li>${tip}</li>`).join('')}
					</ul>
					<p><a href="${item.link}" target="_blank" rel="noopener">å…¬å¼ã‚µã‚¤ãƒˆã§è©³ã—ãè¦‹ã‚‹</a></p>
				`;
				highlightContainer.appendChild(card);
			});
		}

		function createPresetButtons() {
			presetQuestions.forEach(question => {
				const button = document.createElement('button');
				button.type = 'button';
				button.textContent = question;
				button.addEventListener('click', () => {
					userInput.value = question;
					userInput.focus();
				});
				presetContainer.appendChild(button);
			});
		}

		function addMessage(role, text) {
			const message = document.createElement('div');
			message.className = `message ${role}`;
			message.innerHTML = `
				<div class="avatar" aria-hidden="true">${role === 'bot' ? 'AI' : 'ğŸ‘¤'}</div>
				<div class="message-content">${text}</div>
			`;
			chatLog.appendChild(message);
			chatLog.scrollTop = chatLog.scrollHeight;
		}

		function normalize(text) {
			return text
				.toLowerCase()
				.replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 65248))
				.replace(/[\s\u3000]+/g, ' ')
				.trim();
		}

		function scoreItem(item, queryTokens) {
			const fields = [item.name, item.category, item.summary, item.tips.join(' '), item.keywords.join(' ')].join(' ').toLowerCase();
			let score = 0;
			queryTokens.forEach(token => {
				if (fields.includes(token)) {
					score += 4;
				}
			});
			if (item.seasons.some(season => queryTokens.includes(season))) {
				score += 3;
			}
			if (/ãƒ¢ãƒ‡ãƒ«|ã‚³ãƒ¼ã‚¹|è¡Œç¨‹/.test(queryTokens.join(''))) {
				score += item.category.includes('è‡ªç„¶') ? 1 : 2;
			}
			return score;
		}

		function searchKnowledgeBase(query) {
			const normalized = normalize(query);
			if (!normalized) return [];
			const tokens = normalized.split(' ');

			const scored = knowledgeBase
				.map(item => ({ item, score: scoreItem(item, tokens) }))
				.filter(entry => entry.score > 0)
				.sort((a, b) => b.score - a.score)
				.slice(0, 3);

			return scored.map(entry => entry.item);
		}

		function buildAnswer(query) {
			const results = searchKnowledgeBase(query);
			if (results.length === 0) {
				return `ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ãã®ãƒ†ãƒ¼ãƒã«å¯¾å¿œã™ã‚‹æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚<br>
				ãƒ»å­£ç¯€åï¼ˆä¾‹ï¼šæ˜¥ã€å†¬ï¼‰<br>
				ãƒ»å ´æ‰€åï¼ˆä¾‹ï¼šç«‹å±±ã€äº”ç®‡å±±ï¼‰<br>
				ãªã©ã€å°‘ã—å…·ä½“çš„ã«æ•™ãˆã¦ã„ãŸã ã‘ã‚‹ã¨è©³ã—ãã”æ¡ˆå†…ã§ãã¾ã™ã€‚`;
			}

			const suggestions = results.map(item => {
				const seasons = item.seasons.join('ãƒ»');
				const tips = item.tips.map(tip => `ãƒ»${tip}`).join('<br>');
				return `
					<strong>${item.name}</strong>ï¼ˆã‚«ãƒ†ã‚´ãƒªï¼š${item.category}ï¼ãŠã™ã™ã‚æ™‚æœŸï¼š${seasons}ï¼‰<br>
					${item.summary}<br>
					${tips}<br>
					<a href="${item.link}" target="_blank" rel="noopener">å…¬å¼ã‚µã‚¤ãƒˆã§è©³ç´°ã‚’è¦‹ã‚‹</a>
				`;
			}).join('<hr style="border:none;border-top:1px solid rgba(0,105,180,0.1);">');

			return suggestions;
		}

		chatForm.addEventListener('submit', event => {
			event.preventDefault();
			const query = userInput.value.trim();
			if (!query) return;

			addMessage('user', query);
			const answer = buildAnswer(query);
			addMessage('bot', answer);
			userInput.value = '';
			userInput.focus();
		});

		// åˆæœŸåŒ–å‡¦ç†
		createHighlightCards();
		createPresetButtons();
		addMessage('bot', 'ã“ã‚“ã«ã¡ã¯ã€‚å¯Œå±±è¦³å…‰AIã‚¬ã‚¤ãƒ‰ã§ã™ã€‚å­£ç¯€ã®ãŠã™ã™ã‚ã‚„ãƒ¢ãƒ‡ãƒ«ã‚³ãƒ¼ã‚¹ã€ã‚°ãƒ«ãƒ¡æƒ…å ±ãªã©ã€ãŠæ°—è»½ã«è³ªå•ã—ã¦ãã ã•ã„ã€‚');
	</script>
</body>
</html>
